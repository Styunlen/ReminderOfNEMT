<!DOCTYPE html>
<html window-frame="transparent">

<head>
    <meta charset="UTF-8" />
    <title>高考倒计时设置</title>
    <link rel="shortcuticon" href="./favicon.ico" />
    <link rel="stylesheet" type="text/css" href="./win_setting.css">
    <script type="text/tiscript">
        include "win_setting.tis";
        include "hitokoto.tis";
        include "announcement.tis";
        const body = $(body);

        function wizard(stack)
        {
            $(.title).state.current = true;
            if(stack.length)
                stack[0].state.current = true;
        }  
        var stack = $(section#optionsContentStack);
        wizard(stack);

        function animationDone(evt)
        {
            if(evt.reason == 0 && evt.data == #style)
            {
                var idx = this.index;
                this.attributes["sliding"] = undefined;
                this.state.current = true;
                this.unsubscribe(animationDone);
                return true;
            }
        }
        function animationStart(el,direction)
        {
            self.state.focus = true;
            el.attributes["sliding"] = direction; // reset to initial animation state.
            el.post(:: this.attributes["sliding"] = "run" );    // set to final animation state - triggers animation.
            el.subscribe(animationDone,Event.BEHAVIOR_EVENT,Event.ANIMATION);
        }
        event click $(p.title){
            
            console.log(this.text,this.index);
            var current = stack.$(:root>:current);
            //current属性只有在当前选中项结束进入动画时才会设置
            //因此，如果current为空，则说明仍处于切换动画状态，此时不做任何操作
            //补充：结束动画时必有一个current元素
            if(current==#undefined) return;
            //改变目录标题
            $(#cataTitle).text = "当前目录> " +  this.text;
            var new_current = stack[this.index];
            console.log(current.index,new_current.index);
            if(current.index == new_current.index) return;
            current.state.current = false;//在展示当前选项的切换动画时自动隐藏上一个选项的设置界面，防止覆盖显示
            this.state.current = true;//将当前选项标题高亮显示
            //选择动画方向(从上往下，从下往上)
            if(current.index > new_current.index)
            {
                animationStart(new_current,"bottom");
            }                  
            else
            {
                animationStart(new_current,"top");
            }
            if(this.text == "一言")
            {
                
            }
        }
        var options = {theme:"简约(内置)",time:Date.local(2022, 1, 6, 00, 00, 00)}; //默认主题为简约，时间为一月选考时间

        function self.ready()
        {
            view.windowIcon = "./favicon.ico";
            body.timer(1, ::this.attributes.addClass("shown"));
            var currentTheme = NA_getThemeName();//"Rect";
            console.info("Current theme via NA_getThemeName(): ",NA_getThemeName());
            /*$(#themes).value.themeName = "Rect";
            switch(currentStyle)
            {
                case "Circle":
                    $(button[value=Circle]).value = true;
                    break;
                case "Rect":
                    style = "Rect";
                    $(button[value=Rect]).value = true;
                    break;  
                default:
                    $(button[value=Circle]).value = true;
                    break;
            }*/
            var strTimeset,dateTarget;
            strTimeset = NA_getTime();
            if(strTimeset == "NULL")
                dateTarget = new Date(2022,01,06,00,00,00);
            else
                dateTarget = new Date(strTimeset);
            console.log("Timeset formatted: ",dateTarget.toString("%F"));
            $(#calendar).value = dateTarget.toString("%F");//日历表的初始化格式为YYYY-MM-DD
            //Fixed 修复若打开设置窗口后没有使用日历表更改时间，则关闭窗口保存设置时目标日期永远是1月6号的Bug
            // @Time 2020-10-03
            options.time = dateTarget;
            //Fixed 修复新版窗口若打开后没有更改主题，则关闭窗口保存设置时主题永远是Circle的Bug
            // @Time 2020-10-03
            options.theme = currentTheme;
            $(#EngineVer).text = String.printf("%d.%d.%d.%d.%s",
            (Sciter.VERSION >> 16) & 0xffff, Sciter.VERSION & 0xffff,
            (Sciter.REVISION >> 16) & 0xffff, Sciter.REVISION & 0xffff,Sciter.BUILD.toString());
            self.timer(1000ms, getHitokoto);
            getAnnouncement();
            var startIndex = view.parameters.startIndex;
            if(startIndex != #undefined)
            {
                if(startIndex < stack.length) stack[startIndex].state.current = true;
                var title = $$(.title);
                if(startIndex < title.length) title[startIndex].state.current = true;          
            }
        }
        $(#calendar).on("change",function(){
            console.log("时间更改为", $(#calendar).value.toString()," 时间戳:",$(#calendar).value.valueOf());
            options.time = $(#calendar).value;
            //stdout.println(typeof($(#calendar).value));
        });

        $(#close).onClick = function() {
            body.attributes.removeClass("shown");
            console.info("Setting saving...");
            console.info("Current Window Theme change to: ", options.theme);
            console.info("Current Time set to: ", options.time.toString());
            body.onAnimationEnd = function(){
                NA_setTime(options.time);
                if(options.theme != NA_getThemeName())
                {
                    NA_setThemeName(options.theme);//$(#themes).value.themeName);
                    NA_setPos("Center");
                    var ret = view.msgbox(#question,"是否现在就激活新主题","提示",[ {id:#yes, text:"好的"}, {id:#no, text:"返回"} ] );
                    if(ret == #yes)
                    {
                        NA_setPos("Center");
                        view.parameters.hostview.root.ns.IA_loadTheme(NA_getThemeName());
                        view.msgbox(#information,"激活主题成功！","提示")
                    }
                }            
                console.info("Succeed");           
                view.close("设置窗口关闭");
            };       
        }
        event click $(a[href]) {
            stdout.printf("link (%s) clicked\n",this.attributes["href"]);
            Sciter.launch(this.attributes["href"]);
            return true;
        }
        $(#EngineVer).text = String.printf("%d.%d.%d.%d.%s",
            (Sciter.VERSION >> 16) & 0xffff, Sciter.VERSION & 0xffff,
            (Sciter.REVISION >> 16) & 0xffff, Sciter.REVISION & 0xffff,Sciter.BUILD.toString());
    </script>


</head>

<body>
    <section #header>
        <caption style="padding-left:2dip;font-weight: bold;font-size: 16dip;" role="window-caption"><img
                style="width: 16px;height: 16px;" src="favicon.ico"> 高考倒计时设置</caption>
        <button.window role="window-minimize" #minimize></button>
        <button.window role="window-maximize" #maximize></button>
        <button.window #close></button>
    </section>
    <section #main>
        <section #sidebar>
            <p .title>主题</p>
            <p .title>时间</p>
            <p .title>关于</p>
            <p .title>一言</p>
            <p .title>公告</p>
            <div .fix></div>
        </section>
        <section #optionsContent>
            <h3 #cataTitle>当前目录> 主题选择</h3>
            <section #optionsContentStack>
                <section #theme-selection style="background:rgba(red, green, blue, 0.8)">
                    <div class="theme-browser">
                        <div class="themes">
                            <div class="add-new-theme">            
                                <div class="theme-add"></div>
                                <h2>添加新主题</h2>
                            </div>

                            <div class="theme">
                                <div class="theme-screenshot">
                                    <img src="./theme-circle.png" alt="">
                                </div>
                                <div class="theme-id-container">
                                    <h2 class="theme-name">圆形进度条(内置)</h2>
                                    <div class="theme-actions">
                                        <a class="button theme_enable">启用</a>
                                        <a class="button button-primary">实时预览</a>
                                    </div>
                                </div>
                            </div>

                            <div class="theme">
                                <div class="theme-screenshot">
                                    <img src="./theme-rect.png" alt="">
                                </div>
                                <div class="theme-id-container">
                                    <h2 class="theme-name">矩形(内置)</h2>
                                    <div class="theme-actions">
                                        <a class="button theme_enable">启用</a>
                                        <a class="button button-primary">实时预览</a>
                                    </div>
                                </div>
                            </div>

                            <div class="theme">
                                <div class="theme-screenshot">
                                    <img src="./theme-simple.png" alt="">
                                </div>
                                <div class="theme-id-container">
                                    <h2 class="theme-name">简约(内置)</h2>
                                    <div class="theme-actions">
                                        <a class="button theme_enable">启用</a>
                                        <a class="button button-primary">实时预览</a>
                                    </div>
                                </div>
                            </div>

                            <div class="theme">
                                <div class="theme-screenshot">
                                    <img src="./theme-waiting.png" alt="">
                                </div>
                                <div class="theme-id-container">
                                    <h2 class="theme-name">未完待续</h2>
                                    <div class="theme-actions">
                                        <a class="button disabled">启用</a>
                                        <a class="button button-primary">实时预览</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section style="background:rgba(red, green, blue, 0.8)">
                    <widget #calendar value="2021-01-06" type="calendar" />
                </section>
                <section style="background:rgba(red, green, blue, 0.8);padding:0 10dip 0 10dip;">
                    <p>本软件已遵循GPL v3协议开源</p>
                    <p></p>
                    <p>Developer: Styunlen(九仞)</p>
                    <p>Language: C++, HTML+CSS, Tiscript</p>
                    <p>UI: Sciter</br>
                        (Embeddable HTML/CSS/script engine for modern UI development)
                    </p>
                    <p>Blog: <a href="https://styunlen.cn/" target="_blank">https://styunlen.cn/</a></p>
                    <p>Github: <a href="https://github.com/Styunlen/ReminderOfNEMT"
                            target="_blank">https://github.com/Styunlen/ReminderOfNEMT</a></p>
                    <p>QQ: 1208533483 (请备注来源)</p>
                    <p>E-mail: 1208533483@qq.com</p>
                    <div style="position: relative;left:45dip;">
                        <div class="StatusTitle">Version</div>
                        <div class="StatusContent" style="color: #D5EAF6;background-color: #007EC6;">

                        </div>
                        <div class="StatusTitle">Sciter</div>
                        <div class="StatusContent" #EngineVer style="color: #FAFDF2;background-color: #B2D742;"></div>
                        <div class="StatusTitle" style="margin-top:5px;clear:left">License</div>
                        <div class="StatusContent" style="margin-top:5px;color: #FFE9DE;background-color: #FE7D37;">
                            GPL v3
                        </div>
                    </div>
                </section>
                <section>
                    <a class="button button-primary hitokoto_getMore" style="margin: auto auto;">获取更多</a>
                    <p style="text-align: center;">感谢一言提供的API: <a href="https://developer.hitokoto.cn/sentence/">https://developer.hitokoto.cn/sentence/</a></p>
                    <p style="text-align: center;" id="hitokoto_getting">
                        <span class="proBarContainer"><span class="proBar"></span></span>
                    </p>
                    
                    <ol id="hitokoto">
                    </ol>
                </section>

                <section>
                    <a class="button button-primary announcement_retry" style="margin: auto auto;">刷新</a>
                    <p id="announcement_getting">获取中...</p>
                    <center><p id="announcement_uptime"></p></center>
                    <div id="announcement_content">
                        
                    </div>
                </section>
            </section>
        </section>
        <p #copyright>Copyright(c) 2020 九仞 版权所有</p>
    </section>
</body>

</html>